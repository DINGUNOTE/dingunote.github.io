---
layout: single
title: "[javascript] 스크립트 실행 시점을 제어할 수 있는 async와 defer 속성"

date: 2021-09-01 12:40:00 +0900
last-mod: 2021-09-01 12:40:00 +0900

header:
    overlay_image: 
    

category: javascript

toc: true 
toc_sticky: true

---


브라우저는 HTML 파일을 위에서부터 순차적으로 한 줄씩 읽어 나가기 시작합니다.<br>HTML을 읽다가 `<script>...</script>` 태그를 만나면 해당 스크립트를 모두 해석하기 전까지 DOM 생성이 멈추게 됩니다.

```html
<head>
    <title>Document</title>
    <script>
        // Case 1
    </script>
</head>
<body>
    
    <div>컨텐츠</div> 

    <div>스크립트 앞에 위치한 컨텐츠</div>

    <script src="long.js"></script> <!-- Case 2 -->

    <div>스크립트 뒤에 위치한 컨텐츠</div>

</body>
```

`<script src="...">...</script>`를 만났을 때도 마찬가지로 외부에서 스크립트를 다운받고 실행한 후에 남은 페이지를 처리합니다.
<br>스크립트들은 대부분 HMTL보다 무겁기 때문에 용량이 커서 다운로드 받고 처리하는 시간이 오래 걸리게 됩니다. 따라서 페이지 위쪽에 용량이 큰 스크립트가 있는 경우 스크립트가 페이지를 막아버리게 되어서 사용자들은 스크립트를 다운받고 실행할 때까지 스크립트 아래쪽 컨텐츠들을 볼 수 없게 됩니다.



이 문제를 해결할 수 있는 방법이 몇 가지가 있습니다.
<br><br>

> ### 첫 번째 방법

```html
<!-- 첫 번째 컨텐츠 제일 하단에 위치 -->
<body>
  <div>컨텐츠 1</div>
  <div>컨텐츠 2</div>
  <div>컨텐츠 3</div>
  <div>컨텐츠 4</div>

  <script src="long-heavy.js"></script>
</body>
```
첫 번째 방법은 완벽한 해결책은 아닙니다. 만약 HTML 문서 자체가 커질 경우에 브라우저가 HTML 문서 전체를 다운로드 한 다음 스크립트를 다운받기 때문에 페이지 속도가 느려질 수 있습니다.  
그래서 이 문제를 해결할 수 있는 방법이 `<script>`의 `async`와 `defer` 속성입니다.
<br><br>

> ### 두 번째 방법 ‘defer’


브라우저는 `defer` 속성이 있는 스크립트를 백그라운드에서 다운로드 합니다. 즉 스크립트를 다운로드 하는 중에도 HTML을 읽는 작업을 멈추지 않습니다. `defer` 스크립트의 실행은 페이지 구성이 끝날 때까지 지연됩니다.
<br><br>`defer` 스크립트는 일반 스크립트와 마찬가지로 HTML에 추가된 순서대로 실행됩니다.

```html
<script defer src="big-long.js"></script> <!-- 무거운 스크립트 -->
<script defer src="small-short.js"></script> <!-- 가벼운 스크립트 -->
```

다운로드는 병렬로 다운받기 때문에 가벼운 스크립트가 먼저 다운로드 될 수는 있지만 무거운 스크립트가 앞에, 가벼운 스크립트가 뒤에 위치해 있기 때문에 가벼운 스크립트는 무거운 스크립트가 실행될 때까지 기다린 후에 실행됩니다.
* `defer` 속성은 외부 스크립트일 때만 유효합니다. 외부 스크립트가 아닐 때에는 속성은 무시됩니다.

<br>

> ### 세 번째 방법 ‘async’


브라우저에서 `async` 속성이 있는 스크립트는 페이지와 완전히 독립적으로 동작합니다.
* `async` 스크립트는 `defer` 스크립트처럼 백그라운드에서 다운로드 됩니다. 따라서 `async` 스크립트가 다운로드 완료되길 기다리지 않고 페이지 내 컨텐츠를 처리하고 출력합니다.
* 다른 스크립트들은 `async` 스크립트를 기다리지 않습니다. `async` 스크립트 역시 다른 스크립트들을 기다리지 않습니다.

이러한 특징 때문에 `async` 스크립트가 여러 개 사용 된 경우, 그 실행 순서를 예상하기 어렵습니다. 실행은 다운로드가 끝난 스크립트 순으로 진행됩니다.

```html
<script async src="big-long.js"></script> <!-- 무거운 스크립트 -->
<script async src="small-short.js"></script> <!-- 가벼운 스크립트 -->
```

위치 상으로는 가벼운 스크립트가 아래이긴 하지만 무거운 스크립트보다 먼저 다운로드 되면 먼저 실행됩니다.

* 만약 두 스크립트가 서로 의존성이 있다면 제대로 동작하지 않을 수 있습니다.
* 실행 순서가 보장되지 않기 때문에 DOM에 접근하는 스크립트를 `async` 방식으로 불러오는 것은 권장되지 않습니다.

<br><br>

> ### 결론

* DOM을 따라 반드시 순서대로 실행되어야 하는 스크립트라면 `<script>`
* DOM이나 다른 스크립트에 의존성이 있고, 실행 순서가 중요하다면 `<script defer>`
* DOM이나 다른 스크립트에 의존성이 없고, 실행 순서가 중요하지 않다면 `<script async>`