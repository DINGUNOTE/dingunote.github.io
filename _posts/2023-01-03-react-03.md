---
layout: single
title: 'React18 ì´ì „ê³¼ ì´í›„ì˜ batching'

date: 2023-01-03 18:51:00 +0900
last-mod: 2023-01-03 19:22:00 +0900

category: React
---

## ğŸ“Œ batching

- `ë°°ì¹­(batching)`ì€ ì—…ë°ì´íŠ¸ ëŒ€ìƒì´ ë˜ëŠ” ìƒíƒœ ê°’ë“¤ì„ í•˜ë‚˜ì˜ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì–´ì„œ í•œ ë²ˆì˜ ë¦¬ë Œë”ë§ìœ¼ë¡œ ì—…ë°ì´íŠ¸ê°€ ëª¨ë‘ ì§„í–‰ë  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.
- í•œ í•¨ìˆ˜ ì•ˆì—ì„œ `setState`ë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•˜ë”ë¼ë„ ë¦¬ë Œë”ë§ì€ ë‹¨ í•œ ë²ˆë§Œ ë°œìƒí•œë‹¤.

  ```javascript
  function App() {
    const [count, setCount] = useState(0);
    const [flag, setFlag] = useState(false);

    function handleClick() {
      setCount((count) => count + 1); // ì•„ì§ ë¦¬ë Œë”ë§ì„ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ
      setFlag((flag) => !flag); // ì•„ì§ ë¦¬ë Œë”ë§ì„ ë°œìƒì‹œí‚¤ì§€ ì•ŠìŒ
      // ReactëŠ” ë§ˆì§€ë§‰ì— í•œ ë²ˆë§Œ ë‹¤ì‹œ ë¦¬ë Œë”ë§ëœë‹¤.(batching)
    }

    return (
      <div>
        <button onClick={handleClick}>Next</button>
        <h1 style={{ color: flag ? 'blue' : 'black' }}>{count}</h1>
      </div>
    );
  }
  ```

  âœ”ï¸ í•¨ìˆ˜ì˜ ëì—ì„œ ì—…ë°ì´íŠ¸ê°€ ë˜ê³  ReactëŠ” ë§ˆì§€ë§‰ì— í•œ ë²ˆë§Œ ë¦¬ë Œë”ë§ëœë‹¤. ì—¬ëŸ¬ ë²ˆ ë¦¬ë Œë”ë§ í•˜ëŠ” ê²ƒì„ ë§‰ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ìƒ ì´ì ì´ ìˆë‹¤.

## ğŸ“Œ React18 ì´ì „ê¹Œì§€ì˜ batch update

- React18 ì´ì „ ë²„ì „ì—ì„œë„ ì´ëŸ° `batch update`ê°€ ì§€ì›ëì§€ë§Œ í´ë¦­ê³¼ ê°™ì€ ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸ì—ì„œë§Œ ì ìš©ì´ ê°€ëŠ¥í–ˆê³ , api í˜¸ì¶œì— ì½œë°±ìœ¼ë¡œ ë„£ì€ í•¨ìˆ˜ë‚˜ setTimeout í•¨ìˆ˜ ë“±ì—ì„œëŠ” ì‘ë™í•˜ì§€ ì•Šì•˜ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë§ì€ ë¦¬ë Œë”ë§ìœ¼ë¡œ ì„±ëŠ¥ ìƒ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆì—ˆë‹¤.

  ```javascript
  function handleClick() {
    fetchSomething().then(() => {
      // React18 ì´ì „ ë²„ì „ì˜ ê²½ìš° batchingì´ ì‘ë™í•˜ì§€ ì•ŠìŒ
      setCount((count) => count + 1); // ë¦¬ë Œë”ë§ ë°œìƒ
      setFlag((flag) => !flag); // ë¦¬ë Œë”ë§ ë°œìƒ
      // ê°ê°ì˜ setStateë§ˆë‹¤ ë¦¬ë Œë”ë§ì´ ë°œìƒí•¨
    });
  }

  setTimeout(() => {
    // React18 ì´ì „ ë²„ì „ì˜ ê²½ìš° batchingì´ ì‘ë™í•˜ì§€ ì•ŠìŒ
    setCount((count) => count + 1); // ë¦¬ë Œë”ë§ ë°œìƒ
    setFlag((flag) => !flag); // ë¦¬ë Œë”ë§ ë°œìƒ
    // ê°ê°ì˜ setStateë§ˆë‹¤ ë¦¬ë Œë”ë§ì´ ë°œìƒí•¨
  }, 1000);
  ```

## ğŸ“Œ batch ì²˜ë¦¬ë¥¼ ì›í•˜ì§€ ì•Šì„ ë•Œ

- ì¼ë°˜ì ìœ¼ë¡œ `ì¼ê´„ ì²˜ë¦¬(batching)`ì€ ì•ˆì „í•˜ì§€ë§Œ ì¼ë¶€ ì½”ë“œì—ì„œ ìƒíƒœ ë³€ê²½ ì§í›„ DOMì—ì„œ ë¬´ì–¸ê°€ë¥¼ ì½ëŠ” ë° ì˜ì¡´í•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ê²½ìš° `ReactDOM.flushSync()`ë¥¼ ì‚¬ìš©í•´ì„œ Automatic batchingì„ í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

  ```javascript
  import { flushSync } from 'react-dom';

  function handleClick() {
    flushSync(() => {
      setCount(count + 1);
    });
    // ë¦¬ì•¡íŠ¸ê°€ ë°”ë¡œ DOM ì—…ë°ì´íŠ¸ë¥¼ í•œë‹¤. (ë¦¬ë Œë”ë§)

    flushSync(() => {
      setFlag(true);
    });
    // ë¦¬ì•¡íŠ¸ê°€ ë°”ë¡œ DOM ì—…ë°ì´íŠ¸ë¥¼ í•œë‹¤. (ë¦¬ë Œë”ë§)
  }
  ```

## ğŸ“Œ React18ì˜ Automatic batching

- ë” ë‚˜ì€ ì„±ëŠ¥ì„ ìœ„í•´ ë” ì ì€ ë¦¬ë Œë”ë§ì„ í•œë‹¤.
- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë°–ì—ì„œë„ ì‘ë™í•œë‹¤.
- í•„ìš”í•  ë•ŒëŠ” ì œì™¸í•  ìˆ˜ ìˆë‹¤.

> ### ì°¸ê³ <br>[Automatic batching for fewer renders in React 18](https://github.com/reactwg/react-18/discussions/21)
